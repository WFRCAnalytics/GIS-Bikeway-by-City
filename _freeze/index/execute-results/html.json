{
  "hash": "d65a78fe1c0fbd76eaad8e3579c61081",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Analyzing the Utah Bikeways data\nsubtitle: Comparing the bikeways by type with the highway mileage for each city\ndescription: This analysis calculates and compares roadway lane miles and bikeway facility miles across Utah municipalities using spatial data from the Utah Geospatial Resource Center (UGRC).\nauthor:\n - name: Pukar Bhandari\n   email: pukar.bhandari@wfrc.utah.gov\n   affiliation:\n     - name: Wasatch Front Regional Council\n       url: \"https://wfrc.utah.gov/\"\ndate: \"2025-11-16\"\n---\n\n# Introduction\n\nThis analysis examines the distribution of roadway and bikeway infrastructure across Utah municipalities. The primary objectives are to:\n\n1. Calculate total road lane miles for each municipality\n2. Calculate bikeway lane miles by facility type for each municipality\n3. Compare roadway and bikeway infrastructure across municipalities\n\nAll spatial data is sourced from the Utah Geospatial Resource Center (UGRC) and processed using the R spatial ecosystem.\n\n# Setup Environment\n\n## Install Packages\n\nThe following packages are required for this analysis. Install them if not already available in your R environment.\n\n```r\ninstall.packages(\"dplyr\")\ninstall.packages(\"tidyr\")\ninstall.packages(\"readr\")\ninstall.packages(\"fs\")\ninstall.packages(\"sf\")\ninstall.packages(\"arcgislayers\")\ninstall.packages(\"janitor\")\ninstall.packages(\"units\")\ninstall.packages(\"tmap\")\n```\n\n## Load Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr) # for data manipulation\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyr) # for tidy data operations (pivot functions)\nlibrary(readr) # read and write tabular data\nlibrary(fs) # for file system management\nlibrary(sf) # for simple feature geometries\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.13.1, GDAL 3.11.0, PROJ 9.6.0; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(arcgislayers) # to read arcgis rest services\nlibrary(janitor) # clean column names\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'janitor'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(units) # set and adjust units of measurement\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nudunits database from C:/Users/Pukar.Bhandari/AppData/Local/R/win-library/4.5/units/share/udunits/udunits2.xml\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tmap) # view sf objects\n```\n:::\n\n\n## Environment Variables\n\nWe use EPSG:3566 (NAD83(HARN) / Utah North) projection, which uses US survey feet as the base unit. This projection is appropriate for statewide analysis in Utah and ensures accurate distance calculations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set Project CRS\nPROJECT_CRS = \"EPSG:3566\"\n\n# Set tmap mode to interactive\ntmap::tmap_mode(\"view\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ tmap modes \"plot\" - \"view\"\nℹ toggle with `tmap::ttm()`\n```\n\n\n:::\n:::\n\n\n# Read Data from UGRC\n\nAll spatial datasets are downloaded from UGRC's ArcGIS REST services. To improve performance and enable offline work, the data is cached locally as GeoDatabase files. The code checks if local copies exist before downloading.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set data folder\ndir_data <- \"_data/UGRC\"\nfs::dir_create(dir_data) # Create a directory if it doesnt exist\n```\n:::\n\n\n## Utah City Boundaries\n\nMunicipal boundaries are used to aggregate roadway and bikeway data by city. These boundaries represent the legal limits of incorporated municipalities in Utah.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define paths\npath_ut_cities <- file.path(dir_data, \"UtahMunicipalBoundaries.gdb\")\n\n# Download if not exists\nif (!fs::file_exists(path_ut_cities)) {\n  # Read data using arcgis package\n  sf_ut_cities <- arcgislayers::arc_read(\n    \"https://services1.arcgis.com/99lidPhWCzftIe9K/ArcGIS/rest/services/UtahMunicipalBoundaries/FeatureServer/0\",\n    crs = PROJECT_CRS\n  ) |> janitor::clean_names()\n  # Write to a GeoDatabase\n  sf_ut_cities |>\n    sf::st_write(path_ut_cities, layer = \"UtahMunicipalBoundaries\", append = FALSE)\n} else {\n  # Read from local copy\n  sf_ut_cities <- sf::st_read(path_ut_cities) |>\n    sf::st_transform(PROJECT_CRS)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `UtahMunicipalBoundaries' from data source \n  `D:\\GitHub\\GIS-Bikeway-by-City\\_data\\UGRC\\UtahMunicipalBoundaries.gdb' \n  using driver `OpenFileGDB'\nSimple feature collection with 259 features and 17 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 934991.8 ymin: 6077738 xmax: 2272474 ymax: 7898798\nProjected CRS: NAD83 / Utah Central (ftUS)\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap::qtm(sf_ut_cities)\n```\n:::\n\n\n## Utah Roadways\n\nThe Utah Roads dataset contains all roadway centerlines statewide, including the number of through lanes for each road segment. This forms the basis for calculating road lane miles.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define paths\npath_ut_roads <- file.path(dir_data, \"UtahRoads.gdb\")\n\n# Download if not exists\nif (!fs::file_exists(path_ut_roads)) {\n  # Read data using arcgis package\n  sf_ut_roads <- arcgislayers::arc_read(\n    \"https://services1.arcgis.com/99lidPhWCzftIe9K/ArcGIS/rest/services/UtahRoads/FeatureServer/0\",\n    crs = PROJECT_CRS\n  ) |> janitor::clean_names()\n  # Write to a GeoDatabase\n  sf_ut_roads |>\n    sf::st_write(path_ut_roads, layer = \"UtahRoads\", append = FALSE)\n} else {\n  # Read from local copy\n  sf_ut_roads <- sf::st_read(path_ut_roads) |>\n    sf::st_transform(PROJECT_CRS)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `UtahRoads' from data source \n  `D:\\GitHub\\GIS-Bikeway-by-City\\_data\\UGRC\\UtahRoads.gdb' using driver `OpenFileGDB'\nSimple feature collection with 410604 features and 86 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 895206.4 ymin: 6071653 xmax: 2356671 ymax: 7904448\nProjected CRS: NAD83 / Utah Central (ftUS)\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap::qtm(sf_ut_roadways)\n```\n:::\n\n\n## Utah Bikeways\n\nThe Bikeways dataset contains all existing bicycle facilities in Utah. Each segment has two facility type attributes (`facility1` and `facility2`) representing the bicycle facility in each direction of travel.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define paths\npath_ut_bikeways <- file.path(dir_data, \"Bikeways.gdb\")\n\n# Download if not exists\nif (!fs::file_exists(path_ut_bikeways)) {\n  # Read data using arcgis package\n  sf_ut_bikeways <- arcgislayers::arc_read(\n    \"https://services1.arcgis.com/99lidPhWCzftIe9K/ArcGIS/rest/services/Bikeways/FeatureServer/0\",\n    crs = PROJECT_CRS\n  ) |> janitor::clean_names()\n  # Write to a GeoDatabase\n  sf_ut_bikeways |>\n    sf::st_write(path_ut_bikeways, layer = \"Bikeways\", append = FALSE)\n} else {\n  # Read from local copy\n  sf_ut_bikeways <- sf::st_read(path_ut_bikeways) |>\n    sf::st_transform(PROJECT_CRS)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Bikeways' from data source \n  `D:\\GitHub\\GIS-Bikeway-by-City\\_data\\UGRC\\Bikeways.gdb' using driver `OpenFileGDB'\nSimple feature collection with 101693 features and 12 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 896123 ymin: 6076384 xmax: 2356440 ymax: 7904448\nProjected CRS: NAD83 / Utah Central (ftUS)\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap::qtm(sf_ut_bikeways)\n```\n:::\n\n\n# Road Lane Miles by Municipality\n\n## Calculate Lane Miles\n\nRoad lane miles are calculated by multiplying the length of each road segment by the number of through lanes. For road segments where the through lane count is missing (NA), we assume 1 lane as a conservative estimate.\n\nThe calculation converts the geometry length from US survey feet to miles using the `units` package, which properly handles unit conversions and maintains unit awareness throughout the analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsf_ut_roads <- sf_ut_roads |>\n    dplyr::mutate(\n        # TODO: fix thrulanes data\n        dot_thrulanes = dplyr::if_else(is.na(dot_thrulanes), 1, dot_thrulanes),\n        miles = units::set_units(sf::st_length(`SHAPE`), \"mile\"),\n        lane_miles = units::set_units(dot_thrulanes * miles, \"mile\")\n    )\n\nsf_ut_roads |>\n  dplyr::select(dot_thrulanes, miles, lane_miles) |>\n  head(20)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 20 features and 3 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 1525086 ymin: 6823427 xmax: 1690992 ymax: 7058250\nProjected CRS: NAD83 / Utah Central (ftUS)\nFirst 10 features:\n   dot_thrulanes             miles        lane_miles\n1              1 1.52909874 [mile] 1.52909874 [mile]\n2              1 2.86144968 [mile] 2.86144968 [mile]\n3              1 1.06293998 [mile] 1.06293998 [mile]\n4              1 0.80867386 [mile] 0.80867386 [mile]\n5              1 0.71336950 [mile] 0.71336950 [mile]\n6              1 0.36598669 [mile] 0.36598669 [mile]\n7              1 0.09770893 [mile] 0.09770893 [mile]\n8              1 0.25556167 [mile] 0.25556167 [mile]\n9              1 1.16984782 [mile] 1.16984782 [mile]\n10             1 0.30950636 [mile] 0.30950636 [mile]\n                            SHAPE\n1  MULTILINESTRING ((1580305 6...\n2  MULTILINESTRING ((1582439 6...\n3  MULTILINESTRING ((1585991 6...\n4  MULTILINESTRING ((1655301 7...\n5  MULTILINESTRING ((1548359 6...\n6  MULTILINESTRING ((1614298 6...\n7  MULTILINESTRING ((1606261 7...\n8  MULTILINESTRING ((1606826 6...\n9  MULTILINESTRING ((1525086 6...\n10 MULTILINESTRING ((1616278 6...\n```\n\n\n:::\n:::\n\n\n## Aggregate by Municipality\n\nUsing spatial join, we associate each road segment with its municipality and sum the lane miles. Roads that fall outside municipal boundaries will have NA for city_name.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate total lane miles by municipality\nroad_miles_by_city <- sf_ut_roads |>\n    sf::st_join(\n      sf_ut_cities |>\n          dplyr::rename(`city_name` = `name`) |>\n          dplyr::select(`city_name`),\n      join = sf::st_intersects\n    ) |>\n    dplyr::group_by(city_name) |>\n    dplyr::summarize(\n      total_lane_miles = sum(lane_miles, na.rm = TRUE),\n      .groups = \"drop\"\n    ) |>\n    sf::st_drop_geometry()\n\n# View the results\nroad_miles_by_city |>\n  dplyr::arrange(dplyr::desc(total_lane_miles))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 256 × 2\n   city_name        total_lane_miles\n   <chr>                      [mile]\n 1 <NA>                       98275.\n 2 Salt Lake City               905.\n 3 St. George                   766.\n 4 West Valley City             478.\n 5 West Jordan                  475.\n 6 Lehi                         423.\n 7 Sandy                        417.\n 8 South Jordan                 412.\n 9 Layton                       383.\n10 Provo                        380.\n# ℹ 246 more rows\n```\n\n\n:::\n:::\n\n\n**Key Finding:** Salt Lake City has the highest road lane miles among Utah municipalities, followed by St. George and West Valley City. The NA category represents roads outside municipal boundaries (unincorporated areas, state highways between cities, etc.).\n\n# Bikeway Miles by Municipality\n\n## Calculate Bikeway Lane Miles by Facility Type\n\nBikeway facilities are directional - a single bikeway segment can have different facility types in each direction (`facility1` and `facility2`). For this analysis, we treat each direction as a separate lane, meaning a 1-mile bikeway segment with bike lanes in both directions counts as 2 lane-miles of bike lanes.\n\nThe `pivot_longer()` function stacks `facility1` and `facility2` into separate rows, effectively doubling the mileage for segments where both directions have facilities. We then group by municipality and facility type to calculate total lane miles for each combination.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare bikeways with both directions as lanes\nbikeway_miles_by_city <- sf_ut_bikeways |>\n    dplyr::select(facility1, facility2) |>\n    dplyr::mutate(\n      miles = units::set_units(sf::st_length(SHAPE), \"mile\")\n    ) |>\n    sf::st_join(\n      sf_ut_cities |>\n          dplyr::rename(`city_name` = `name`) |>\n          dplyr::select(`city_name`),\n      join = sf::st_intersects\n    ) |>\n    sf::st_drop_geometry() |>\n    tidyr::pivot_longer(\n      cols = c(facility1, facility2),\n      values_to = \"facility\"\n    ) |>\n    dplyr::group_by(city_name, facility) |>\n    dplyr::summarize(\n      total_lane_miles = sum(as.numeric(miles), na.rm = TRUE),\n      .groups = \"drop\"\n    ) |>\n    tidyr::pivot_wider(\n      names_from = facility,\n      values_from = total_lane_miles,\n      values_fill = 0\n    )\n\nbikeway_miles_by_city\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 256 × 12\n   city_name     `Bike lane (2B)` `Not Available` `Shoulder bikeway (3A)`\n   <chr>                    <dbl>           <dbl>                   <dbl>\n 1 Alpine                    1.43          124.                    15.5  \n 2 Alta                      0               8.90                   2.08 \n 3 Altamont                  0               5.19                   0    \n 4 Alton                     0              16.4                    5.96 \n 5 Amalga                    0              32.9                    0    \n 6 American Fork             9.41          308.                    19.7  \n 7 Annabella                 0              20.3                    3.31 \n 8 Antimony                  0             107.                     0    \n 9 Apple Valley              0             134.                     0.714\n10 Aurora                    0              27.8                    0.698\n# ℹ 246 more rows\n# ℹ 8 more variables: `Trail or Pathway` <dbl>,\n#   `Signed shared roadway (3C)` <dbl>, `Buffered bike lane (2A)` <dbl>,\n#   `Cycle track, raised and curb separated (1C)` <dbl>,\n#   `Marked shared roadway (3B)` <dbl>,\n#   `Cycle track, at-grade, protected with parking (1A)` <dbl>,\n#   `Cycle track, protected with barrier (1B)` <dbl>, …\n```\n\n\n:::\n:::\n\n\n**Key Finding:** Bikeway infrastructure varies significantly by facility type across municipalities. The dataset includes various facility types such as bike lanes, protected bike lanes, shared-use paths, and trails.\n\n# Combine dataframes\n\n## Create Multimodal Summary\n\nThe final step combines road lane miles and bikeway lane miles by facility type into a single dataset. This allows for direct comparison of roadway and bikeway infrastructure across municipalities.\n\nEach row represents a municipality, with columns for total road lane miles followed by columns for each bikeway facility type. Cities with zero bikeway miles for a particular facility type will show 0 in that column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Combine with roads\ncombined_miles_by_city <- road_miles_by_city |>\n  dplyr::mutate(road_lane_miles = as.numeric(total_lane_miles)) |>\n  dplyr::select(city_name, road_lane_miles) |>\n  dplyr::full_join(bikeway_miles_by_city, by = \"city_name\")\n\ncombined_miles_by_city |>\n  dplyr::arrange(dplyr::desc(road_lane_miles))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 256 × 13\n   city_name        road_lane_miles `Bike lane (2B)` `Not Available`\n   <chr>                      <dbl>            <dbl>           <dbl>\n 1 <NA>                      98275.            10.2           53260.\n 2 Salt Lake City              905.           234.             1042.\n 3 St. George                  766.            13.6             875.\n 4 West Valley City            478.            26.8             793.\n 5 West Jordan                 475.            58.2             717.\n 6 Lehi                        423.             9.68            668.\n 7 Sandy                       417.            45.4             634.\n 8 South Jordan                412.            65.0             640.\n 9 Layton                      383.            13.5             603.\n10 Provo                       380.            86.0             529.\n# ℹ 246 more rows\n# ℹ 9 more variables: `Shoulder bikeway (3A)` <dbl>, `Trail or Pathway` <dbl>,\n#   `Signed shared roadway (3C)` <dbl>, `Buffered bike lane (2A)` <dbl>,\n#   `Cycle track, raised and curb separated (1C)` <dbl>,\n#   `Marked shared roadway (3B)` <dbl>,\n#   `Cycle track, at-grade, protected with parking (1A)` <dbl>,\n#   `Cycle track, protected with barrier (1B)` <dbl>, …\n```\n\n\n:::\n:::\n\n\n**Key Finding:** The ratio of bikeway lane miles to road lane miles varies considerably across Utah municipalities, indicating different levels of investment in bicycle infrastructure relative to overall roadway networks.\n\n# Export Final results\n\nThe analysis results are exported as a CSV file for further use in reports, visualizations, or other analyses. The output directory is created automatically if it doesn't exist.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set data folder\ndir_output <- \"_output\"\nfs::dir_create(dir_output) # Create a directory if it doesnt exist\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_miles_by_city |>\n    readr::write_csv(\n        file.path(dir_output, \"miles_by_city.csv\"),\n        append = FALSE\n    )\n```\n:::\n\n\n::: {.callout-tip title=\"Download the output files:\"}\n[miles_by_city.csv](./_output/miles_by_city.csv)\n:::\n\n# Conclusion\n\nThis analysis provides a comprehensive inventory of roadway and bikeway infrastructure across Utah municipalities. The methodology is reproducible and can be updated as new data becomes available from UGRC. The spatial join approach ensures accurate attribution of infrastructure to municipalities, though users should note that roads and bikeways in unincorporated areas will appear under the NA category.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}